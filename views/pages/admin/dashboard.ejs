<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/stylesheets/style.css">
  <link rel="stylesheet" href="/stylesheets/admin-dashboard.css">
</head>
<body>
  <div class="admin-container">
    <!-- Sidebar Navigation -->
    <aside class="admin-sidebar">
      <div class="admin-logo">
        <h2>Admin Panel</h2>
      </div>

      <nav class="admin-nav">
        <ul>
          <li class="nav-item active">
            <a href="/admin" class="nav-link">
              <i class="icon-dashboard"></i> Dashboard
            </a>
          </li>
          <% if (hasPermission('appointments', 'view')) { %>
            <li class="nav-item">
              <a href="/admin/appointments" class="nav-link">
                <i class="icon-calendar"></i> Appointments
              </a>
            </li>
          <% } %>
          <% if (hasPermission('customers', 'view')) { %>
            <li class="nav-item">
              <a href="/admin/customers" class="nav-link">
                <i class="icon-users"></i> Customers
              </a>
            </li>
          <% } %>
          <% if (hasPermission('staff', 'view')) { %>
            <li class="nav-item">
              <a href="/admin/staff" class="nav-link">
                <i class="icon-team"></i> Staff
              </a>
            </li>
          <% } %>
          <% if (hasPermission('services', 'view')) { %>
            <li class="nav-item">
              <a href="/admin/services" class="nav-link">
                <i class="icon-services"></i> Services
              </a>
            </li>
          <% } %>
          <% if (hasPermission('inventory', 'view')) { %>
            <li class="nav-item">
              <a href="/admin/inventory" class="nav-link">
                <i class="icon-inventory"></i> Inventory
              </a>
            </li>
          <% } %>
          <% if (hasPermission('reports', 'view')) { %>
            <li class="nav-item">
              <a href="/admin/reports" class="nav-link">
                <i class="icon-chart"></i> Reports
              </a>
            </li>
          <% } %>
          <% if (hasPermission('settings', 'view')) { %>
            <li class="nav-item">
              <a href="/admin/settings" class="nav-link">
                <i class="icon-settings"></i> Settings
              </a>
            </li>
          <% } %>
        </ul>
      </nav>

      <div class="admin-user-info">
        <div class="user-avatar"><%= user.givenName.charAt(0).toUpperCase() %></div>
        <div class="user-details">
          <p class="user-name"><%= user.givenName %> <%= user.familyName %></p>
          <p class="user-role"><%= getRoleDisplayName(user.role) %></p>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
      <!-- Top Bar -->
      <div class="admin-topbar">
        <h1 class="page-title"><%= title %></h1>
        <div class="topbar-actions">
          <div class="time-display" id="currentTime"></div>
          <a href="/auth/logout" class="btn btn-logout">Logout</a>
        </div>
      </div>

      <!-- Page Content -->
      <div class="admin-content">
        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
          <!-- Appointments Stats -->
          <div class="stat-card">
            <div class="stat-header">
              <h3>Today's Appointments</h3>
              <span class="stat-icon">üìÖ</span>
            </div>
            <div class="stat-body">
              <div class="stat-value"><%= appointmentStats.total %></div>
              <div class="stat-subtext">Total appointments</div>
            </div>
            <div class="stat-details">
              <div class="detail">
                <span class="detail-label">Upcoming:</span>
                <span class="detail-value"><%= appointmentStats.upcoming %></span>
              </div>
              <div class="detail">
                <span class="detail-label">Completed:</span>
                <span class="detail-value"><%= appointmentStats.completed %></span>
              </div>
            </div>
          </div>

          <!-- Revenue Stats -->
          <div class="stat-card highlight">
            <div class="stat-header">
              <h3>Today's Revenue</h3>
              <span class="stat-icon">üíµ</span>
            </div>
            <div class="stat-body">
              <div class="stat-value"><%= formatCurrency(revenueStats.totalRevenue * 100) %></div>
              <div class="stat-subtext">From <%= revenueStats.completedCount %> completed services</div>
            </div>
            <div class="stat-details">
              <div class="detail">
                <span class="detail-label">Average per service:</span>
                <span class="detail-value"><%= formatCurrency(revenueStats.averageValue * 100) %></span>
              </div>
            </div>
          </div>

          <!-- Customer Stats -->
          <div class="stat-card">
            <div class="stat-header">
              <h3>Customer Base</h3>
              <span class="stat-icon">üë•</span>
            </div>
            <div class="stat-body">
              <div class="stat-value"><%= customerStats.total %></div>
              <div class="stat-subtext">Total customers</div>
            </div>
            <div class="stat-details">
              <div class="detail">
                <span class="detail-label">With phone:</span>
                <span class="detail-value"><%= customerStats.withPhone %></span>
              </div>
              <div class="detail">
                <span class="detail-label">With email:</span>
                <span class="detail-value"><%= customerStats.withEmail %></span>
              </div>
            </div>
          </div>

          <!-- Cancellations Alert -->
          <div class="stat-card alert">
            <div class="stat-header">
              <h3>Cancellations & No-Shows</h3>
              <span class="stat-icon">‚ö†Ô∏è</span>
            </div>
            <div class="stat-body">
              <div class="stat-value"><%= appointmentStats.cancelled + appointmentStats.noShow %></div>
              <div class="stat-subtext">Cancellations today</div>
            </div>
            <div class="stat-details">
              <div class="detail">
                <span class="detail-label">Cancelled:</span>
                <span class="detail-value"><%= appointmentStats.cancelled %></span>
              </div>
              <div class="detail">
                <span class="detail-label">No-show:</span>
                <span class="detail-value"><%= appointmentStats.noShow %></span>
              </div>
            </div>
          </div>
        </div>

        <!-- Upcoming Appointments Section -->
        <div class="section">
          <div class="section-header">
            <h2>Upcoming Appointments (Next 7 Days)</h2>
            <a href="/admin/appointments" class="link-view-all">View All ‚Üí</a>
          </div>

          <% if (upcomingAppointments && upcomingAppointments.length > 0) { %>
            <div class="appointments-list">
              <% upcomingAppointments.forEach((apt) => { %>
                <div class="appointment-item">
                  <div class="apt-time">
                    <%= new Date(apt.startAt).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'}) %>
                  </div>
                  <div class="apt-duration">
                    <%= formatDuration(apt.appointmentSegments?.[0]?.durationMinutes * 60000 || 0) %>
                  </div>
                  <div class="apt-info">
                    <div class="apt-customer">Customer: <%= apt.customerId || 'Unknown' %></div>
                    <div class="apt-status status-<%= apt.status?.toLowerCase() %>"><%= apt.status %></div>
                  </div>
                  <div class="apt-actions">
                    <a href="/admin/appointments/<%= apt.id %>" class="btn-small btn-view">View</a>
                  </div>
                </div>
              <% }); %>
            </div>
          <% } else { %>
            <div class="empty-state">
              <p>No upcoming appointments in the next 7 days</p>
            </div>
          <% } %>
        </div>

        <!-- Quick Actions -->
        <div class="section">
          <h2>Quick Actions</h2>
          <div class="quick-actions">
            <% if (hasPermission('appointments', 'create')) { %>
              <a href="/services" class="action-btn">
                <span class="action-icon">‚ûï</span>
                <span class="action-text">New Appointment</span>
              </a>
            <% } %>
            <% if (hasPermission('customers', 'create')) { %>
              <a href="/contact" class="action-btn">
                <span class="action-icon">üë§</span>
                <span class="action-text">Add Customer</span>
              </a>
            <% } %>
            <% if (hasPermission('reports', 'view')) { %>
              <a href="/admin/reports" class="action-btn">
                <span class="action-icon">üìä</span>
                <span class="action-text">View Reports</span>
              </a>
            <% } %>
            <a href="/" class="action-btn">
              <span class="action-icon">üè†</span>
              <span class="action-text">Main Site</span>
            </a>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Update current time
    function updateTime() {
      const now = new Date();
      document.getElementById('currentTime').textContent = now.toLocaleTimeString();
    }
    updateTime();
    setInterval(updateTime, 1000);
  </script>
</body>
</html>
